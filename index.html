<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Mini Jogo Fugitivo Competitivo</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    
    <style>
        /* CSS: Estilizando o Jogo */
        body { 
            text-align: center; 
            font-family: Arial, sans-serif; 
            background-color: #f0f0f0; 
            padding-top: 20px; 
            overflow: hidden; 
        }
        #main-layout {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        #game-container { 
            background: white; 
            width: 80vw; 
            max-width: 600px;
            height: 400px; 
            padding: 20px; 
            border-radius: 15px; 
            box-shadow: 0 8px 16px rgba(0,0,0,0.2); 
            position: relative; 
            border: 2px dashed #00bfff; 
            overflow: hidden; 
        }
        #ranking-container {
            width: 250px;
            background: #fff;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: left;
        }
        #ranking-container h2 {
            color: #0077b6;
            margin-top: 0;
            border-bottom: 2px solid #00bfff;
            padding-bottom: 5px;
        }
        .rank-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px dotted #ccc;
            font-size: 14px;
        }
        .rank-item:last-child { border-bottom: none; }
        
        #fugitive-button { 
            background-color: #ff6666; 
            color: white; 
            border: none; 
            font-size: 16px; 
            border-radius: 8px; 
            cursor: pointer; 
            transition: all 0.4s ease-out; 
            position: absolute; 
            z-index: 10;
        }
        #controls {
            margin-bottom: 20px;
        }
        .score, #timer { 
            font-size: 28px; 
            font-weight: bold; 
            color: #00bfff; 
            margin: 10px 0; 
            display: inline-block;
            margin-right: 20px;
        }
        #message { color: #555; }
        
        #difficulty-select, #player-id { 
            padding: 10px; 
            border-radius: 5px; 
            font-size: 16px; 
            border: 2px solid #00bfff; 
        }
        #player-id { margin-right: 15px; }
    </style>
</head>
<body>

    <h1>Mini Jogo Fugitivo Competitivo!</h1>
    
    <div id="controls">
        <input type="text" id="player-id" placeholder="Seu ID/Nome (Ex: Fera123)" maxlength="10">
        <label for="difficulty-select">Dificuldade:</label>
        <select id="difficulty-select" onchange="configurarDificuldade()">
            <option value="easy">Fácil (15s)</option>
            <option value="medium">Médio (10s)</option>
            <option value="hard">Difícil (5s)</option>
        </select>
    </div>

    <div id="main-layout">
        
        <div id="game-info">
            <div id="timer">Tempo: 0.0s</div>
            <div class="score">Cliques: <span id="score">0</span></div>
            <div id="game-container">
                <button id="fugitive-button" onclick="cliqueBotao()">
                    PEGUE-ME!
                </button>
            </div>
            <p id="message">Digite seu ID e Selecione a Dificuldade para começar!</p>
        </div>
        
        <div id="ranking-container">
            <h2>Melhores Recordes</h2>
            <div id="ranking-list">
                </div>
        </div>

    </div>

    <script>
        // 2. CHAVES DO FIREBASE (Configuração fornecida)
        const firebaseConfig = {
          apiKey: "AIzaSyAjfuzzPSyfEmfbw13qf-K-OlSd9yugeOE",
          authDomain: "mini-jogo-fugitivo.firebaseapp.com",
          projectId: "mini-jogo-fugitivo",
          storageBucket: "mini-jogo-fugitivo.firebasestorage.app",
          messagingSenderId: "1037732757514",
          appId: "1:1037732757514:web:a72365c217941c23339ff3"
        };

        // Inicializa o Firebase e o Firestore (Método v8)
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // Variáveis e Constantes do Jogo
        const TEMPO_JOGO = { easy: 15, medium: 10, hard: 5 }; 
        let pontos = 0;
        let dificuldadeAtual = 'easy';
        let tempoRestante = TEMPO_JOGO[dificuldadeAtual];
        let cronometro;
        let jogoAtivo = false;
        let tempoInicio;

        const botao = document.getElementById("fugitive-button");
        const container = document.getElementById("game-container");
        const seletorDificuldade = document.getElementById("difficulty-select");
        const playerIdInput = document.getElementById("player-id");
        const scoreDisplay = document.getElementById("score");
        const timerDisplay = document.getElementById("timer");
        const messageDisplay = document.getElementById("message");
        const rankingList = document.getElementById("ranking-list");

        const configuracoes = {
            easy: { tamanho: '20px 40px', transicao: '0.4s ease-out' },
            medium: { tamanho: '15px 30px', transicao: '0.25s ease-out' },
            hard: { tamanho: '10px 20px', transicao: '0.1s linear' }
        };

        // --- Funções de Jogo ---

        function configurarDificuldade() {
            if(jogoAtivo) return; 
            
            dificuldadeAtual = seletorDificuldade.value;
            const config = configuracoes[dificuldadeAtual];
            
            botao.style.padding = config.tamanho;
            botao.style.transition = config.transicao;
            
            tempoRestante = TEMPO_JOGO[dificuldadeAtual];
            timerDisplay.innerText = `Tempo: ${tempoRestante.toFixed(1)}s`;
            scoreDisplay.innerText = 0;
            pontos = 0;
            
            messageDisplay.innerText = `Pronto! Dificuldade ${dificuldadeAtual.toUpperCase()}. Clique no botão para iniciar o tempo.`;
            
            botao.disabled = false;
            botao.style.opacity = 1;
            moverBotao(true);
            carregarRecordes(); 
        }

        function iniciarJogo() {
            const playerId = playerIdInput.value.trim();
            if (playerId.length === 0) {
                alert("Por favor, digite seu ID/Nome para começar o jogo!");
                playerIdInput.focus();
                return;
            }
            
            jogoAtivo = true;
            tempoInicio = Date.now();
            cronometro = setInterval(atualizarTempo, 100);
            messageDisplay.innerText = "JOGO COMEÇOU! PEGUE-O RAPIDAMENTE!";
            botao.onmouseover = null;
        }
        
        function atualizarTempo() {
            const tempoDecorrido = (Date.now() - tempoInicio) / 1000;
            tempoRestante = TEMPO_JOGO[dificuldadeAtual] - tempoDecorrido;
            
            if (tempoRestante <= 0) {
                tempoRestante = 0;
                finalizarJogo();
            }
            
            timerDisplay.innerText = `Tempo: ${tempoRestante.toFixed(1)}s`;
        }

        function finalizarJogo() {
            clearInterval(cronometro);
            jogoAtivo = false;
            botao.disabled = true;
            botao.style.opacity = 0.5;
            
            const tempoFinal = TEMPO_JOGO[dificuldadeAtual];
            
            messageDisplay.innerText = `FIM DE JOGO! Você fez ${pontos} cliques em ${tempoFinal.toFixed(1)} segundos.`;
            
            // Salva no Firebase
            salvarRecorde(playerIdInput.value.trim(), pontos, tempoFinal);
        }

        function cliqueBotao() {
            if (!jogoAtivo) {
                iniciarJogo();
            }

            if (jogoAtivo) {
                pontos++;
                scoreDisplay.innerText = pontos;
                
                // Feedback visual e reposicionamento
                botao.style.backgroundColor = '#4CAF50';
                setTimeout(() => {
                    botao.style.backgroundColor = '#ff6666';
                }, 100);
                
                moverBotao(); 
            }
        }

        function moverBotao() {
            const containerRect = container.getBoundingClientRect();
            const buttonRect = botao.getBoundingClientRect();

            const maxX = containerRect.width - buttonRect.width;
            const maxY = containerRect.height - buttonRect.height;
            
            const newX = Math.floor(Math.random() * maxX);
            const newY = Math.floor(Math.random() * maxY);

            botao.style.left = newX + 'px';
            botao.style.top = newY + 'px';
        }

        // --- Funções de Ranking (FIREBASE) ---

        function carregarRecordes() {
            rankingList.innerHTML = '<p>Carregando ranking global...</p>';
            
            db.collection("ranking")
              .where("dificuldade", "==", dificuldadeAtual)
              .orderBy("score", "desc")
              .limit(10)
              .get()
              .then((querySnapshot) => {
                  const records = [];
                  querySnapshot.forEach((doc) => {
                      records.push(doc.data());
                  });
                  exibirRecordes(records);
              })
              .catch((error) => {
                  console.error("Erro ao carregar recordes do Firebase: ", error);
                  rankingList.innerHTML = '<p>Erro ao carregar o ranking. Verifique o console.</p>';
              });
        }

        function salvarRecorde(id, score, time) {
            db.collection("ranking").add({
                id: id,
                score: score,
                time: time,
                dificuldade: dificuldadeAtual,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                messageDisplay.innerText += " Recorde salvo com sucesso no Ranking Global!";
                carregarRecordes();
            })
            .catch((error) => {
                console.error("Erro ao salvar recorde no Firebase: ", error);
                messageDisplay.innerText += " Erro ao salvar recorde.";
            });
        }

        function exibirRecordes(records) {
            rankingList.innerHTML = ''; 
            
            if (records.length === 0) {
                rankingList.innerHTML = '<p>Nenhum recorde ainda para esta dificuldade.</p>';
                return;
            }
            
            records.forEach((record, index) => {
                const item = document.createElement('div');
                item.className = 'rank-item';
                item.innerHTML = `
                    <span>**${index + 1}.** ${record.id}</span>
                    <span>**${record.score}** cliques</span>
                `;
                rankingList.appendChild(item);
            });
        }

        // --- Inicialização ---

        window.onload = () => {
             configurarDificuldade(); 
             seletorDificuldade.addEventListener('change', configurarDificuldade);
             
             // Mantém o ID do jogador salvo no navegador (localStorage)
             const lastId = localStorage.getItem('lastPlayerId');
             if (lastId) {
                 playerIdInput.value = lastId;
             }
             playerIdInput.addEventListener('input', () => {
                 localStorage.setItem('lastPlayerId', playerIdInput.value.trim());
             });
        };
    </script>

</body>
</html>