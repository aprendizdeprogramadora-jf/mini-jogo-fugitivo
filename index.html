<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Jogo Fugitivo - Ultimate Version</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    
    <style>
        /* --- TRANSI√á√ÉO E CORES TEMA CLARO --- */
        body { 
            text-align: center; 
            font-family: 'Segoe UI', sans-serif; 
            background-color: #f0f4f8; 
            color: #333;
            margin: 0;
            padding-top: 50px;
            /* Efeito de Fade Suave */
            transition: background-color 0.5s ease, color 0.5s ease; 
        }

        /* --- MODO NOTURNO --- */
        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }

        /* --- BOT√ÉO FLUTUANTE (CANTO ESQUERDO) --- */
        #theme-toggle-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 15px;
            border-radius: 30px;
            cursor: pointer;
            z-index: 1000;
            font-weight: bold;
            border: 2px solid #00bfff;
            background-color: white;
            transition: all 0.5s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .dark-mode #theme-toggle-btn {
            background-color: #333;
            color: white;
            border-color: #bb86fc;
            box-shadow: 0 4px 10px rgba(187, 134, 252, 0.3);
        }

        /* --- LAYOUT DO JOGO --- */
        #main-layout { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-top: 20px; }
        
        #game-container, #ranking-container {
            background: white;
            border-radius: 15px;
            transition: all 0.5s ease;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        .dark-mode #game-container, .dark-mode #ranking-container {
            background: #1e1e1e;
            border-color: #bb86fc;
        }

        #game-container { 
            width: 80vw; max-width: 600px; height: 400px; 
            position: relative; border: 3px solid #00bfff; overflow: hidden; 
        }
        .dark-mode #game-container { border-color: #bb86fc; }

        #ranking-container { width: 280px; padding: 20px; text-align: left; border: 1px solid #ddd; }
        .dark-mode #ranking-container { border-color: #333; }

        /* --- BOT√ÉO E OBST√ÅCULOS --- */
        #fugitive-button { 
            background-color: #ff4757; color: white; border: none; padding: 12px 18px;
            font-weight: bold; border-radius: 8px; cursor: pointer; position: absolute; z-index: 10;
        }
        .obstacle { 
            position: absolute; background-color: #adb5bd; border-radius: 5px; 
            z-index: 5; pointer-events: none; opacity: 0.6; transition: all 0.5s ease;
        }
        .dark-mode .obstacle { background-color: #3700b3; border: 1px solid #bb86fc; }

        /* --- TEXTOS --- */
        .stats { font-size: 22px; font-weight: bold; color: #0077b6; margin-bottom: 15px; transition: 0.5s; }
        .dark-mode .stats { color: #03dac6; }
        #ranking-list div { padding: 8px 0; border-bottom: 1px solid #eee; }
        .dark-mode #ranking-list div { border-bottom-color: #333; }
    </style>
</head>
<body>

    <button id="theme-toggle-btn" onclick="toggleDarkMode()">üåô Modo Noturno</button>

    <h1>Mini Jogo Fugitivo üéÆ</h1>
    
    <div id="controls">
        <input type="text" id="player-id" placeholder="Digite seu ID" maxlength="10" style="padding: 10px; border-radius: 5px; border: 1px solid #ccc;">
        <select id="difficulty-select" onchange="configurarDificuldade()" style="padding: 10px; border-radius: 5px;">
            <option value="easy">F√°cil (Sem Obst√°culos)</option>
            <option value="medium">M√©dio (3 Obst√°culos)</option>
            <option value="hard">Dif√≠cil (6 Obst√°culos)</option>
        </select>
    </div>

    <div id="main-layout">
        <div>
            <div class="stats">
                <span id="timer">Tempo: 0.0s</span> | Cliques: <span id="score">0</span>
            </div>
            <div id="game-container">
                <button id="fugitive-button" onclick="cliqueBotao()">PEGUE-ME!</button>
            </div>
            <p>O jogo come√ßa no primeiro clique!</p>
        </div>
        
        <div id="ranking-container">
            <h3 style="margin-top: 0;">üèÜ Top 10 Ranking</h3>
            <div id="ranking-list">Carregando...</div>
        </div>
    </div>

    <script>
        // --- CONFIGURA√á√ÉO FIREBASE ---
        const firebaseConfig = {
          apiKey: "AIzaSyAjfuzzPSyfEmfbw13qf-K-OlSd9yugeOE",
          authDomain: "mini-jogo-fugitivo.firebaseapp.com",
          projectId: "mini-jogo-fugitivo",
          storageBucket: "mini-jogo-fugitivo.firebasestorage.app",
          messagingSenderId: "1037732757514",
          appId: "1:1037732757514:web:a72365c217941c23339ff3"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- EFEITOS SONOROS ---
        const somClique = new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3');
        const somFim = new Audio('https://www.soundjay.com/buttons/sounds/button-10.mp3');

        // --- L√ìGICA DO JOGO ---
        const TEMPOS = { easy: 15, medium: 10, hard: 5 };
        let pontos = 0, dificuldadeAtual = 'easy', tempoRestante, cronometro, jogoAtivo = false;

        const botao = document.getElementById("fugitive-button");
        const container = document.getElementById("game-container");

        function toggleDarkMode() {
            const corpo = document.body;
            corpo.classList.toggle('dark-mode');
            const btn = document.getElementById('theme-toggle-btn');
            btn.innerHTML = corpo.classList.contains('dark-mode') ? "‚òÄÔ∏è Modo Claro" : "üåô Modo Noturno";
        }

        function gerarObstaculos() {
            document.querySelectorAll('.obstacle').forEach(o => o.remove());
            if (dificuldadeAtual === 'easy') return;
            const qtd = dificuldadeAtual === 'hard' ? 6 : 3;
            for (let i = 0; i < qtd; i++) {
                const obs = document.createElement('div');
                obs.className = 'obstacle';
                const tam = Math.random() * 60 + 40;
                obs.style.width = tam + 'px';
                obs.style.height = tam + 'px';
                obs.style.left = Math.random() * (container.clientWidth - tam) + 'px';
                obs.style.top = Math.random() * (container.clientHeight - tam) + 'px';
                container.appendChild(obs);
            }
        }

        function configurarDificuldade() {
            if(jogoAtivo) return;
            dificuldadeAtual = document.getElementById("difficulty-select").value;
            tempoRestante = TEMPOS[dificuldadeAtual];
            document.getElementById("timer").innerText = `Tempo: ${tempoRestante.toFixed(1)}s`;
            document.getElementById("score").innerText = "0";
            pontos = 0;
            moverBotao();
            carregarRecordes();
        }

        function moverBotao() {
            const x = Math.random() * (container.clientWidth - botao.clientWidth);
            const y = Math.random() * (container.clientHeight - botao.clientHeight);
            botao.style.left = x + 'px';
            botao.style.top = y + 'px';
            if(jogoAtivo) gerarObstaculos();
        }

        function cliqueBotao() {
            somClique.currentTime = 0;
            somClique.play();

            if (!jogoAtivo) {
                const pid = document.getElementById("player-id").value.trim();
                if (!pid) { alert("Digite um ID para salvar seu recorde!"); return; }
                jogoAtivo = true;
                const inicio = Date.now();
                cronometro = setInterval(() => {
                    let decorrido = (Date.now() - inicio) / 1000;
                    tempoRestante = TEMPOS[dificuldadeAtual] - decorrido;
                    if (tempoRestante <= 0) finalizarJogo();
                    document.getElementById("timer").innerText = `Tempo: ${Math.max(0, tempoRestante).toFixed(1)}s`;
                }, 100);
            }
            pontos++;
            document.getElementById("score").innerText = pontos;
            moverBotao();
        }

        function finalizarJogo() {
            clearInterval(cronometro);
            jogoAtivo = false;
            somFim.play();

            const pid = document.getElementById("player-id").value;
            db.collection("ranking").add({
                id: pid, score: pontos, dificuldade: dificuldadeAtual,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                alert(`Fim de jogo! Voc√™ fez ${pontos} cliques.`);
                configurarDificuldade();
            });
        }

        function carregarRecordes() {
            db.collection("ranking").where("dificuldade", "==", dificuldadeAtual)
              .orderBy("score", "desc").limit(10).get().then(snap => {
                document.getElementById("ranking-list").innerHTML = snap.docs.map((doc, i) => 
                    `<div>${i+1}. <b>${doc.data().id}</b> - ${doc.data().score} pts</div>`).join('');
            }).catch(err => {
                document.getElementById("ranking-list").innerHTML = "Erro ao carregar ranking.";
                console.error(err);
            });
        }

        window.onload = configurarDificuldade;
    </script>
</body>
</html>
